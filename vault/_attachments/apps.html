<html>
	<head>
		<title>Vault</title>
		<link rel="stylesheet" type="text/css" href="jquery-ui-1.flick.css"/>
		<style type="text/css">
td, th {
	border: #080 1px solid;
}
		</style>
	</head>
	<body>
		<table id="app-table">
			<tr>
				<th>Name</th>
				<th>Worker</th>
			</tr>
		</table>
	</body>
	
	<script src="/_utils/script/json2.js"></script>
	<script src="/_utils/script/sha1.js"></script>
	<script src="/_utils/script/base64.js"></script>
	<script src="/_utils/script/jquery.js"></script>
	<script src="/_utils/script/jquery.couch.js"></script>
	<script src="vendor/couchapp/md5.js"></script>
	<script src="vendor/couchapp/jquery.mustache.js"></script>
	<script src="jquery-ui-1.10.3.min.js"></script>
	
	<script type="text/javascript">
$(function(){
	$.couch.db('vault').view("indexes/type", {
		include_docs: true,
		key: "app",
		success: function(data) {
			for (var i = 0; i < data.rows.length; i++) {
				showApp(data.rows[i].doc);
			}
		},
		error: function(d1, d2, d3) {
			if (d1 == 401) {
				document.location.href = "index.html";
			} else {
				console.log('Failed to load', d1, d2, d3);
				alert('Failed to load');
			}
		}
	});
});

var showApp = function(appInfo) {
	console.log("Adding app", appInfo);
	var row = '<tr><td>';
	if ('ui' in appInfo) {
		row += '<a href="/' + appInfo.db + '/_design/' + appInfo.ui + '">' + appInfo.name + '</a>';
	} else {
		row += appInfo.name;
	}
	row += '</td><td>';
	if ('worker' in appInfo) {
		row += 'Loading...';
	} else {
		row += 'No worker';
	}
	row += '</td></tr>';
	$('#app-table').append(row);
};
	</script>
</html>